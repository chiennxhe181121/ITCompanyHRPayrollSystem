@model IEnumerable<HumanResourcesManager.BLL.DTOs.UserAccount.UserAccountDTO>
@using HumanResourcesManager.DAL.Shared

@{
    ViewData["Title"] = "Quản Lý Tài Khoản";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    string keyword = Context.Request.Query["keyword"];
    string roleCode = Context.Request.Query["roleCode"];
    string status = Context.Request.Query["status"];
}

@{
    int stt = (ViewBag.CurrentPage - 1) * 10;
}

<div class="px-6 py-5 border-b border-slate-100 bg-slate-50/50">
    <div class="flex items-center justify-between">
        <div>
            <h2 class="text-lg font-semibold text-slate-800">Quản Lý Tài Khoản</h2>
            <p class="text-sm text-slate-500">CRUD tài khoản người dùng</p>
        </div>

        <a href="/HumanResourcesManager/admin/UserAccounts/Create"
           class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl text-sm">
            + Thêm tài khoản
        </a>
    </div>
</div>

<!-- 🔍 SEARCH + FILTER -->
<div class="px-6 py-4 border-b bg-white">
    <form method="get" class="flex flex-wrap gap-3 items-end">

        <!-- SEARCH -->
        <div>
            <label class="text-sm font-medium">Tìm kiếm</label>
            <input name="keyword"
                   value="@keyword"
                   placeholder="Username / Họ tên / Email"
                   class="border rounded-lg px-3 py-2 w-64" />
        </div>

        <!-- ROLE -->
        <div>
            <label class="text-sm font-medium">Vai trò</label>
            <select name="roleCode"
                    class="form-select border rounded-lg px-3 py-2 w-40">
                <option value="">-- Tất cả --</option>
                @* <option value="EMPLOYEE" selected="@(role == "EMPLOYEE")">Employee</option>
                <option value="HR" selected="@(role == "HR")">HR</option>
                <option value="ADMIN" selected="@(role == "ADMIN")">Admin</option>
                <option value="MANAGER" selected="@(role == "MANAGER")">Manager</option> *@
                <option value="ADMIN" selected="@(roleCode == "ADMIN")">Admin</option>
                <option value="HR" selected="@(roleCode == "HR")">HR</option>
                <option value="USER" selected="@(roleCode == "USER")">User</option>
            </select>
        </div>

        <!-- STATUS -->
        <div>
            <label class="text-sm font-medium">Trạng thái</label>
            <select name="status"
                    class="border rounded-lg px-3 py-2 w-36">
                <option value="">-- Tất cả --</option>
                <option value="Active" selected="@(status == "Active")">Active</option>
                <option value="Inactive" selected="@(status == "Inactive")">Inactive</option>
            </select>
        </div>

        <!-- ACTION -->
        <div class="flex gap-2">
            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                Search
            </button>

            <a href="/HumanResourcesManager/admin/UserAccounts"
               class="px-4 py-2 border rounded-lg">
                Reset
            </a>
        </div>
    </form>
</div>

<!-- TABLE -->
<div class="p-6">
    <div class="overflow-x-auto border rounded-xl">
        <table class="w-full text-sm">
            <thead class="bg-slate-50">
                <tr>
                    @* <th class="px-4 py-3">ID</th> *@
                    <th class="px-4 py-3">STT</th>
                    <th class="px-4 py-3">Username</th>
                    <th class="px-4 py-3">Họ tên</th>
                    <th class="px-4 py-3">Email</th>
                    <th class="px-4 py-3">Role</th>
                    <th class="px-4 py-3">Trạng thái</th>
                    <th class="px-4 py-3 text-right">Hành động</th>
                </tr>
            </thead>

            <tbody>
                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="7" class="text-center py-6 text-slate-500">
                            Không tìm thấy tài khoản phù hợp
                        </td>
                    </tr>
                }
                else
                {

                    foreach (var u in Model)
                    {
                        <tr class="border-t hover:bg-slate-50">
                            @* <td class="px-4 py-2">@u.UserId</td> *@
                            <td class="px-4 py-2 text-center font-medium">
                                @(++stt)
                            </td>

                            <td class="px-4 py-2">@u.Username</td>
                            <td class="px-4 py-2">@u.FullName</td>
                            <td class="px-4 py-2">@u.Email</td>

                            <td class="px-4 py-2">
                                @if (u.RoleName == "Admin")
                                {
                                    <span class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-700 font-medium">
                                        Admin
                                    </span>
                                }
                                else if (u.RoleName == "HR")
                                {
                                    <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 font-medium">
                                        HR
                                    </span>
                                }
                                else
                                {
                                    <span class="px-2 py-1 text-xs rounded-full bg-slate-100 text-slate-700 font-medium">
                                        User
                                    </span>
                                }
                            </td>

                            <td class="px-4 py-2">
                                @if (u.Status == Constants.Active)
                                {
                                    <span class="text-emerald-600 font-medium">Active</span>
                                }
                                else
                                {
                                    <span class="text-red-500 font-medium">Inactive</span>
                                }
                            </td>
                            <td class="px-4 py-2 text-right space-x-2">
                                <a href="/HumanResourcesManager/admin/UserAccounts/Edit/@u.UserId"
                                   class="text-blue-600 hover:underline">Edit</a>

                                <a href="/HumanResourcesManager/admin/UserAccounts/ResetPassword/@u.UserId"
                                   class="text-amber-600 hover:underline">Reset PW</a>

                                @if (u.Status == Constants.Active)
                                {
                                    <form method="post"
                                          action="/HumanResourcesManager/admin/UserAccounts/Inactive/@u.UserId"
                                          class="inline">
                                        <button class="text-red-600 hover:underline"
                                                onclick="return confirm('Khoá tài khoản này?')">
                                            Lock
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    <form method="post"
                                          action="/HumanResourcesManager/admin/UserAccounts/Active/@u.UserId"
                                          class="inline">
                                        <button class="text-emerald-600 hover:underline"
                                                onclick="return confirm('Mở khoá tài khoản này?')">
                                            Unlock
                                        </button>
                                    </form>
                                }
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>

        <!-- PAGINATION -->
        @if (ViewBag.TotalPages > 1)
        {
            <div class="flex justify-center mt-6">
                <ul class="flex gap-1 text-sm">

                    @if (ViewBag.CurrentPage > 1)
                    {
                        <li>
                            <a class="px-3 py-1 border rounded"
                               href="?page=@(ViewBag.CurrentPage - 1)&keyword=@keyword&role=@roleCode&status=@status">
                                Trước
                            </a>
                        </li>
                    }

                    @for (int i = 1; i <= ViewBag.TotalPages; i++)
                    {
                        <li>
                            <a class="px-3 py-1 border rounded
                                                       @(i == ViewBag.CurrentPage ? "bg-blue-600 text-white" : "")"
                               href="?page=@i&keyword=@keyword&role=@roleCode&status=@status">
                                @i
                            </a>
                        </li>
                    }

                    @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                    {
                        <li>
                            <a class="px-3 py-1 border rounded"
                               href="?page=@(ViewBag.CurrentPage + 1)&keyword=@keyword&role=@roleCode&status=@status">
                                Sau
                            </a>
                        </li>
                    }
                </ul>
            </div>
        }
    </div>
</div>

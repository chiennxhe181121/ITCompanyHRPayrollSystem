@{
    ViewData["Title"] = "Đổi mật khẩu";
    Layout = "~/Views/Employee/_EmployeeLayout.cshtml";
}

<main class="flex-1 overflow-y-auto bg-slate-50/50">
    @await Html.PartialAsync("_EmployeeHeader")

    <div class="p-5 lg:p-8 flex justify-center">
        <div class="w-full max-w-2xl bg-white rounded-2xl shadow-sm border border-slate-200/60 overflow-hidden">

            <!-- Header -->
            <div class="px-6 py-5 border-b border-slate-200 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 flex items-center justify-center rounded-xl bg-slate-100 text-slate-600">
                        <i class="bi bi-shield-lock text-lg"></i>
                    </div>
                    <div>
                        <h2 class="text-lg font-semibold text-slate-800">
                            Đổi mật khẩu
                        </h2>
                        <p class="text-sm text-slate-500">
                            Cập nhật mật khẩu để bảo mật tài khoản của bạn
                        </p>
                    </div>
                </div>

                <a asp-area="HumanResourcesManager"
                   asp-controller="Employee"
                   asp-action="Profile"
                   class="inline-flex items-center gap-2 px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl text-sm font-medium transition-colors">
                    <i class="bi bi-arrow-left"></i>
                    Quay lại
                </a>
            </div>

            <!-- Form -->
            <div class="p-8 flex justify-center">
                <form method="post"
                      asp-action="ChangePassword"
                      class="w-full max-w-md space-y-6">

                    @Html.AntiForgeryToken()

                    <!-- Current Password -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">
                            Mật khẩu hiện tại
                        </label>

                        <div class="relative">
                            <input type="password"
                                   id="CurrentPassword"
                                   name="CurrentPassword"
                                   class="w-full px-4 py-2.5 pr-12 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 outline-none transition">

                            <button type="button"
                                    onclick="togglePassword('CurrentPassword', this)"
                                    class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>

                    <!-- New Password -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">
                            Mật khẩu mới
                        </label>

                        <div class="relative">
                            <input type="password"
                                   id="newPassword"
                                   name="NewPassword"
                                   class="w-full px-4 py-2.5 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 outline-none transition">

                            <!-- Toggle eye -->
                            <button type="button"
                                    onclick="togglePassword('newPassword', this)"
                                    class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-700">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>

                        <!-- Strength bar -->
                        <div class="mt-3">
                            <div class="h-2 w-full bg-slate-200 rounded-full overflow-hidden">
                                <div id="strengthBar"
                                     class="h-full w-0 transition-all duration-300 rounded-full">
                                </div>
                            </div>
                            <p id="strengthText" class="text-sm mt-1 text-slate-500"></p>
                        </div>
                    </div>

                    <!-- Confirm Password -->
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">
                            Xác nhận mật khẩu
                        </label>

                        <div class="relative">
                            <input type="password"
                                   id="ConfirmPassword"
                                   name="ConfirmPassword"
                                   class="w-full px-4 py-2.5 pr-12 border border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500/40 focus:border-blue-500 outline-none transition">

                            <button type="button"
                                    onclick="togglePassword('ConfirmPassword', this)"
                                    class="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div class="pt-4 flex justify-center gap-3">

                        <button type="submit"
                                class="inline-flex items-center gap-2 px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl shadow-sm transition-colors">
                            <i class="bi bi-check-lg"></i>
                            Lưu mật khẩu
                        </button>

                        <a asp-controller="Employee"
                           asp-action="Profile"
                           class="px-6 py-2.5 bg-red-600 hover:bg-red-700 text-white font-medium rounded-xl shadow-sm transition-colors">
                            Huỷ
                        </a>

                    </div>

                </form>
            </div>

        </div>
    </div>
</main>

<script>

    function togglePassword(id, btn){
        const input = document.getElementById(id);
        const icon = btn.querySelector("i");

        if(input.type === "password"){
            input.type = "text";
            icon.classList.remove("bi-eye");
            icon.classList.add("bi-eye-slash");
        } else {
            input.type = "password";
            icon.classList.remove("bi-eye-slash");
            icon.classList.add("bi-eye");
        }
    }

    const passwordInput = document.getElementById("newPassword");
    const strengthBar = document.getElementById("strengthBar");
    const strengthText = document.getElementById("strengthText");

    passwordInput.addEventListener("input", function(){
        const value = passwordInput.value;
        let strength = 0;

        if(value.length >= 8) strength++;
        if(/[A-Z]/.test(value)) strength++;
        if(/[a-z]/.test(value)) strength++;
        if(/[0-9]/.test(value)) strength++;
        if(/[^A-Za-z0-9]/.test(value)) strength++;

        switch(strength){
            case 0:
            case 1:
                strengthBar.style.width = "20%";
                strengthBar.className = "h-full bg-red-500 transition-all duration-300";
                strengthText.textContent = "Mật khẩu rất yếu";
                break;

            case 2:
                strengthBar.style.width = "40%";
                strengthBar.className = "h-full bg-orange-500 transition-all duration-300";
                strengthText.textContent = "Mật khẩu yếu";
                break;

            case 3:
                strengthBar.style.width = "60%";
                strengthBar.className = "h-full bg-yellow-500 transition-all duration-300";
                strengthText.textContent = "Mật khẩu trung bình";
                break;

            case 4:
                strengthBar.style.width = "80%";
                strengthBar.className = "h-full bg-blue-500 transition-all duration-300";
                strengthText.textContent = "Mật khẩu mạnh";
                break;

            case 5:
                strengthBar.style.width = "100%";
                strengthBar.className = "h-full bg-green-500 transition-all duration-300";
                strengthText.textContent = "Mật khẩu rất mạnh";
                break;
        }
    });

</script>
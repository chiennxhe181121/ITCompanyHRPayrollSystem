@using HumanResourcesManager.BLL.DTOs.Employee
@model EmployeeOwnerProfileDTO

@{
	Layout = "~/Views/Employee/_EmployeeLayout.cshtml";
}

<!-- Main Content -->
<main class="flex-1 overflow-y-auto bg-slate-50/50">
	@await Html.PartialAsync("_EmployeeHeader")

	<div class="p-5 lg:p-8">
		@* @await Html.PartialAsync("_EmployeeStats") *@

		<!-- Tabs Content -->
		<div class="bg-white rounded-2xl shadow-sm border border-slate-200/60 overflow-hidden">
			<!-- Profile Tab -->
			<div id="profileTab" class="tab-content">
				<div class="px-6 py-5 border-b border-slate-100 bg-slate-50/50">
					<h2 class="text-lg font-semibold text-slate-800">Hồ Sơ Cá Nhân</h2>
					<p class="text-sm text-slate-500 mt-0.5">Chỉnh sửa thông tin cá nhân của bạn</p>
				</div>
				<div class="p-6">
					<form id="profileForm"
						  method="post"
						  action="/HumanResourcesManager/employee/update-profile"
						  enctype="multipart/form-data"
						  class="w-full space-y-6">

						@Html.AntiForgeryToken()

						<input type="hidden" id="profileAvatarData" name="ImgAvatar" value="">
						<input type="hidden" name="RemoveAvatar" id="removeAvatarFlag" value="false" />
						<!-- PROFILE HEADER -->
						<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6 pb-6 border-b border-slate-100">

							<!-- LEFT: AVATAR -->
							<div class="flex items-center gap-4">
								@{
									var avatarPath = Model.ImgAvatar;
									var hasAvatar = !string.IsNullOrEmpty(avatarPath);
									var initial = string.IsNullOrEmpty(Model.FullName)
									? "U"
									: Model.FullName.Substring(0, 1).ToUpper();
								}

								<div id="profileAvatarPreview"
									 class="w-24 h-24 rounded-full overflow-hidden bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-2xl font-bold text-white ring-2 ring-slate-200 shadow-inner flex-shrink-0">

									@if (hasAvatar)
									{
										<img id="profileAvatarImg"
											 src="@avatarPath"
											 class="w-full h-full object-cover"
											 alt="Avatar">
									}
									else
									{
										<span id="profileAvatarInitial">@initial</span>
									}

								</div>

								<div id="profileAvatarActions" class="flex flex-col gap-2 hidden">
									<input type="file"
										   id="profileAvatarInput"
										   name="avatarFile"
										   accept="image/*"
										   class="hidden">
									<button type="button" id="profileAvatarBtn"
											class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-xl text-sm font-medium transition-colors">
										Chọn ảnh
									</button>
									<button type="button" id="profileAvatarRemoveBtn"
											class="px-4 py-2 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl text-sm font-medium transition-colors">
										Xóa ảnh
									</button>
								</div>
							</div>

							<!-- RIGHT: ACTION BUTTONS -->
							<div class="flex flex-col sm:flex-row gap-3">
								<button type="button"
										id="profileEditSaveBtn"
										class="inline-flex items-center gap-2 px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-xl shadow-sm transition-colors">

									<i class="bi bi-pencil"></i>
									<span>Chỉnh sửa thông tin</span>
								</button>

								<button type="button"
										id="profileCancelBtn"
										class="hidden px-5 py-2.5 bg-red-600 hover:bg-red-700 text-white font-medium rounded-xl shadow-sm transition-colors">
									Huỷ thay đổi
								</button>

								<a asp-action="ChangePassword"
								   asp-controller="Employee"
								   id="profileChangePasswordBtn"
								   class="inline-flex items-center gap-2 px-5 py-2.5 bg-slate-700 hover:bg-slate-800 text-white font-medium rounded-xl shadow-sm transition-colors">

									<i class="bi bi-shield-lock"></i>
									<span>Đổi mật khẩu</span>
								</a>
							</div>

							<div></div>
						</div>
						<div class="text-red-600 text-sm">
							@if (!ViewData.ModelState.IsValid)
							{
								<div class="mb-6 p-4 rounded-xl bg-red-50 border border-red-200 shadow-sm">
									<div class="flex items-start gap-3">
										<div class="text-red-500 text-lg">
											<i class="bi bi-exclamation-triangle-fill"></i>
										</div>

										<div class="text-sm text-red-700">
											<p class="font-medium mb-1">Có lỗi xảy ra:</p>
											<ul class="list-disc list-inside space-y-1">
												@foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
												{
													<li>@error.ErrorMessage</li>
												}
											</ul>
										</div>
									</div>
								</div>
							}
						</div>
						<div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-6">
							<!-- HỌ TÊN -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">Họ và tên</label>
								<input type="text" id="profileFullName" name="FullName"
									   value="@Model.FullName"
									   class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500"
									   readonly>
							</div>

							<!-- EMAIL -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">Email cá nhân</label>
								<input type="email" id="profileEmail" name="Email"
									   value="@Model.Email"
									   class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500"
									   readonly>
							</div>

							<!-- GIỚI TÍNH -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">
									Giới tính
								</label>

								<select id="profileGender"
										name="Gender"
										asp-for="Gender"
										class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500"
										disabled>
									<option value="true">Nam</option>
									<option value="false">Nữ</option>
								</select>

								<input type="hidden"
									   id="profileGenderHidden"
									   name="Gender"
									   value="@Model.Gender" />
							</div>

							<!-- NGÀY SINH -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">Ngày sinh</label>
								<input type="date" id="profileDob" name="DateOfBirth"
									   value="@Model.DateOfBirth.ToString("yyyy-MM-dd")"
									   class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500" readonly>
							</div>

							<!-- SỐ ĐIỆN THOẠI -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">Số điện thoại</label>
								<input type="tel" id="profilePhone" name="Phone"
									   value="@Model.Phone"
									   class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500" readonly>
							</div>

							<!-- NƠI Ở HIỆN NAY -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">Nơi ở hiện nay</label>
								<input type="text" id="profileAddress"
									   value="@Model.Address" name="Address"
									   class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500" readonly>
							</div>

							<!-- MÃ NHÂN VIÊN -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">Mã nhân viên</label>
								<input type="text" id="profileEmployeeCode"
									   value="@Model.EmployeeCode"
									   class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500"
									   readonly>
							</div>

							<!-- PHÒNG BAN -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">Phòng ban</label>
								<input type="text" id="profileDepartment"
									   value="@Model.DepartmentName"
									   class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500"
									   readonly>
							</div>

							<!-- CHỨC VỤ -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">Chức vụ</label>
								<input type="text" id="profilePosition"
									   value="@Model.PositionName"
									   class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500"
									   readonly>
							</div>

							<!-- NGÀY VÀO LÀM -->
							<div>
								<label class="block text-sm font-medium text-slate-600 mb-1.5">Ngày vào làm</label>
								<input type="text" id="profileHireDate"
									   value="@Model.HireDate.ToString("dd/MM/yyyy")"
									   class="w-full px-4 py-2.5 border border-slate-200 rounded-xl bg-slate-50 text-slate-500"
									   readonly>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</main>

@section Scripts {
	@if (Model != null)
	{
		<script>
			window.currentEmployee = @Html.Raw(Json.Serialize(Model));
		</script>
	}

	<!-- Thông báo cập nhật profile thành công -->
	@if (TempData["Success"] != null)
	{
		<script>
			Swal.fire({
				toast: true,
				position: 'top-end',
				icon: 'success',
				title: @Html.Raw(Json.Serialize(TempData["Success"])),
				showConfirmButton: false,
				timer: 2500,
				timerProgressBar: true
			});
		</script>
	}
}